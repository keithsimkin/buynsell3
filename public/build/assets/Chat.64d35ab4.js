import{Z as vt,i as I,O as Tt,u as bt,j as Ut,k as Pt,z as x,o as a,c as g,b as c,w as d,a as m,m as ke,q as n,t as l,f as A,h as we,g as P,n as Ee,F as rt,s as wt,K as Et,r as w,C as Ot}from"./app.72d9fe45.js";import{f as Oe}from"./index.esm.159b9749.js";import"./auth.esm.925cebae.js";import Bt from"./PsFrontendLayout.374c3b62.js";import Ht from"./PsInput.5af8d533.js";import Dt from"./PsLine.c7f2ab42.js";import Rt from"./PsContentContainer.42cd0324.js";import Mt from"./PsBreadcrumb2.bcdabe6c.js";import Lt from"./PsButton.81d0ce1f.js";import Ft from"./PsDropdown.05bf646c.js";import{P as b}from"./PsUtils.eb7a8002.js";import Nt from"./PsIcon.c404b5b9.js";import Yt from"./PsLabel.dd7b9156.js";import Gt from"./PsLabelTitle3.305e016a.js";import qt from"./PsRouteLink.ab373f40.js";import Vt from"./PsLabelCaption2.913b996f.js";import{P as h}from"./ps_constants.ea9d0b33.js";import{u as jt}from"./NotificationStore.09902b99.js";import{P as zt}from"./PsValueStore.46e374fe.js";import Jt from"./PsLoadingDialog.52bc8b7d.js";import Kt from"./PsConfirmDialog2.c0dba84b.js";import Xt from"./PsErrorDialog.0ec3813f.js";import Wt from"./PsSuccessDialog.ab656243.js";import Zt from"./ChatImageDetail.f847172e.js";import Qt from"./OfferModal.468f9feb.js";import $t from"./BookingModal.c0d1be44.js";import es from"./ReviewModal.23873903.js";import{u as ts}from"./GalleryStore.102224a6.js";import{b as ee}from"./PsApiService.74841eb2.js";import{u as ss}from"./UserStore.e188dd03.js";import{u as os}from"./GetChatHistoryStore.50984f8a.js";import{u as rs}from"./AppInfoStore.3eac0301.js";import{A as is}from"./AppInfoParameterHolder.e24d894d.js";import{u as as}from"./ChatHistoryListStore.df92a83a.js";import{u as ls}from"./OfferStore.509cccf6.js";import{P as ns}from"./PsObject.a17ef38f.js";import{f as ds}from"./format.min.1a01be2e.js";import{u as ms}from"./ProductStore.017d2a02.js";import{U as cs,u as fs}from"./UserUnReadMessageParameterHolder.402a8a72.js";import{h as _s}from"./moment.9709ab41.js";import{_ as us}from"./plugin-vue_export-helper.21dcd24c.js";import"./FooterView.a2566be6.js";import"./FooterLinkSection.2019a7c6.js";import"./PsLink.26c0aa15.js";import"./PsLabelCaption.9bd8d857.js";import"./ProductParameterHolder.b9a2d040.js";import"./DefaultPhoto.cc755f93.js";import"./PsNavTabBar.f7d96f93.js";import"./PsDropdownSelect.405216fe.js";import"./PsIconToggle.4c2e7ec1.js";import"./PsInputWithLeftIcon.b188023e.js";import"./LocationModal.d02e80d4.js";import"./PsModal.49a87bcd.js";import"./vue-neat-modal.d239f4e3.js";import"./LocationParameterHolder.eedeb824.js";import"./ItemLocationTownship.94979fe0.js";import"./PsSepetetedStore.9a31ac47.js";import"./ItemLocationTownshipStore.024edc3b.js";import"./PsNavBar.42e9d556.js";import"./AddToCartStore.7e3033c2.js";import"./ApiStatus.5720ba0b.js";import"./PsConfirmDialog.fdc5ff76.js";import"./User.0c3ba1a8.js";import"./RatingDetail.291ad5d1.js";import"./ProductRelation.0b376978.js";import"./UserListParameterHolder.d110b747.js";import"./PsNotificationBox.38ef8701.js";import"./Phone.45f97258.js";import"./Product.0519ee40.js";import"./Category.7c65464b.js";import"./DefaultIcon.e76b39a5.js";import"./SubCategory.1b4176e0.js";import"./ItemCurrency.91c8ce91.js";import"./Vendor.d946ee87.js";import"./UserDeleteItemParameterHolder.5d816aba.js";import"./NotiUnRegisterHolder.eefb692e.js";import"https://unpkg.com/delayed-scroll-restoration-polyfill@0.1.1/index.js";import"./PsLabelTitle.8e337e9e.js";import"./PsImageModal.42dac1c3.js";import"./ItemCurrencyStore.de2a0bae.js";import"./PsLabelHeader6.98bb71e1.js";import"./ItemEntryParameterHolder.87e7bb8d.js";import"./PsTimePicker.a0559d5c.js";import"./PsDatePicker.fb02ffe1.js";import"./vue3-datepicker.esm.130dd019.js";import"./index.bb4ebfff.js";import"./PsUtils.84756d19.js";import"./RatingSelected.75743a66.js";import"./PsTextarea.a8d7724f.js";import"./RatingHolder.f2b756d9.js";import"./ChatHistory.b5dd3f69.js";import"./SyncChatHistoryParameterHolder.24ffbfbb.js";class hs{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId=""}GetChatHistoryParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r}}class gs{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type="",this.isUserOnline="",this.message=""}MakeOfferParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type=h.CHAT_TO_SELLER,this.isUserOnline="",this.message=""}AcceptOfferParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type=h.CHAT_TO_BUYER,this.isUserOnline="",this.message=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r.nego_price=this.negoPrice,r.type=this.type,r.is_user_online=this.isUserOnline,r.message=this.message,r}}class _e{constructor(){this.addedDateTimeStamp=0,this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="",this.offerStatus=0,this.sendByUserId="",this.sessionId="",this.type=0}ChatParameterHolder(){return this.addedDateTimeStamp=Math.floor(Date.now()),this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="hi",this.offerStatus=h.CHAT_STATUS_NULL,this.sendByUserId="",this.sessionId="",this.type=h.CHAT_TYPE_TEXT,this}ChatAcceptParameterHolder(){return this.addedDateTimeStamp=Math.floor(Date.now()),this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="",this.offerStatus=h.CHAT_STATUS_ACCEPT,this.sendByUserId="",this.sessionId="",this.type=h.CHAT_TYPE_ACCEPT,this}toMap(){const r={};return r.item_id=this.itemId,r.send_by_user_id=this.sendByUserId,r.message=this.message,r.type=this.type,r}}class ps{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.type=""}ResetUnReadMessageHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.type=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r.type=this.type,r}}class Be extends ns{constructor(){super(...arguments),this.id="",this.itemId="",this.sessionId="",this.key="",this.message="",this.type=0,this.sendByUserId="",this.offerStatus=0,this.addedDate="",this.isSold=!1,this.isUserBought=!1,this.dateTimeString="",this.dateString="",this.timeString=""}init(r,f,e,te,R,re,v,C,_,E,k,Y,V,j){return this.id=r,this.itemId=f,this.sessionId=e,this.key=te,this.message=R,this.type=re,this.sendByUserId=v,this.offerStatus=C,this.addedDate=_,this.isSold=E,this.isUserBought=k,this.dateTimeString=Y,this.dateString=V,this.timeString=j,this}getPrimaryKey(){return this.itemId}fromMap(r){return new Be().init(r.id,r.itemId,r.sessionId,r.key,r.message,r.type,r.sendByUserId,r.offerStatus,r.addedDate,r.isSold,r.isUserBought,r.dateTimeString,r.dateString,r.timeString)}fromMapList(r){const f=[];for(const e in r)e!=null&&f.push(this.fromMap(e));return f}toMap(r){const f={};return f.id=r.id,f.itemId=r.itemId,f.sessionId=r.sessionId,f.key=r.key,f.message=r.message,f.type=r.type,f.sendByUserId=r.sendByUserId,f.offerStatus=r.offerStatus,f.addedDate=r.addedDate,f.isSold=r.isSold,f.isUserBought=r.isUserBought,f.dateTimeString=r.dateTimeString,f.dateString=r.dateString,f.timeString=r.timeString,f}toMapList(r){const f=[];for(let e=0;e<r.length;e++)r[e]!=null&&f.push(this.toMap(r[e]));return f}}class ys{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.isUserOnline=""}IsUserBoughtParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.isUserOnline=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r.is_user_online=this.isUserOnline,r}}const ks={name:"ChatView",components:{PsLabel:Yt,PsInput:Ht,PsLine:Dt,PsContentContainer:Rt,PsIcon:Nt,PsLabelTitle3:Gt,PsLabelCaption2:Vt,PsLoadingDialog:Jt,OfferModal:Qt,BookingModal:$t,PsConfirmDialog2:Kt,PsErrorDialog:Xt,PsSuccessDialog:Wt,ChatImageDetail:Zt,PsRouteLink:qt,ReviewModal:es,PsBreadcrumb2:Mt,PsButton:Lt,PsDropdown:Ft,Head:vt},props:["query"],layout:Bt,setup(i){var Ge,qe,Ve,je,ze,Je,Ke,Xe,We,Ze,Qe,$e,et,tt;const f=zt().getLoginUserId(),e=I(!1);(f==null||f==""||f==h.NO_LOGIN_USER)&&Tt.get(route("login"));const te=new cs;te.userId=f,te.deviceToken=localStorage.deviceToken;const R=ms(),re=fs(),v=(Ve=(qe=(Ge=i.query)==null?void 0:Ge.buyer_user_id)==null?void 0:qe.toString())!=null?Ve:"",C=(Je=(ze=(je=i.query)==null?void 0:je.seller_user_id)==null?void 0:ze.toString())!=null?Je:"",_=I(""),E=I(""),k=(We=(Xe=(Ke=i.query)==null?void 0:Ke.item_id)==null?void 0:Xe.toString())!=null?We:"",Y=I("");let V=I("");const j=I(""),ie=($e=(Qe=(Ze=i.query)==null?void 0:Ze.chat_flag)==null?void 0:Qe.toString())!=null?$e:h.CHAT_FROM_BUYER,ae=I("0"),Se=new is;Se.userId=f;const H=rs(),ue=I(!1);((tt=(et=H==null?void 0:H.appInfo)==null?void 0:et.data)==null?void 0:tt.psAppSetting.SelectedChatType)==h.CHAT_AND_APPOINTMENT&&(ue.value=!0);async function xe(){}xe();const K=os(),Ae=as(),X=ts();jt();const F=ls(),W=new hs,S=new gs,o=new _e().ChatParameterHolder(),D=new ys,G=new ps,T=I(),N=I(),le=I(),s=I(),M=I(),ne=I(),O=I(),He=I(),se=I(!1),De=I(),L=I(!1),q=b.sortinUserId(C,v),de=Oe.database().ref("Message/"+q),Re=Oe.database().ref("Current_Chat_With"),he=Oe.database().ref("User_Presence");let z,me=I("");C==f?z=v:z=C;const Me=ss("chat");Me.loadUser(z),G.itemId=k,G.buyerUserId=v,G.sellerUserId=C,ie==h.CHAT_FROM_SELLER?G.type=h.CHAT_TO_BUYER:G.type=h.CHAT_TO_SELLER;const Le=I(""),Ce=bt({data:[]});async function Z(){var t,p;W.itemId=k,W.buyerUserId=v,W.sellerUserId=C,await K.loadChatHistory(W,f),se.value=!0,((p=(t=K.chatHistory)==null?void 0:t.data)==null?void 0:p.isOffer)=="1"&&(se.value=!1)}function Ie(t){t.target.scrollTop<50&&b.log("load more......")}function J(){const t=new Date().getTime();return b.getTimeStampDividedByOneThousand(parseInt(t.toString(),10))}async function it(t){o.id="",o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=t,o.offerStatus=h.CHAT_STATUS_NULL,o.sendByUserId=f,o.sessionId=q,o.type=h.CHAT_TYPE_TEXT,await B(o,!0)}async function B(t,p=!1){var ce;let y;t.id==""?y=(ce=de.push().key)!=null?ce:"":y=t.id;const u=t.sendByUserId,Q={addedDate:t.addedDateTimeStamp,id:y,isSold:t.isSold,isUserBought:t.isUserBought,itemId:t.itemId,message:t.message,offerStatus:t.offerStatus,sendByUserId:t.sendByUserId,sessionId:t.sessionId,type:t.type},$={itemId:t.itemId,receiverId:z,senderId:u},pe={userId:u,userName:"Tester"};de.child(y).set(Q),Re.child(u).set($),he.child(u).set(pe);let oe="0";L.value&&(oe="1"),p&&(ie==h.CHAT_FROM_SELLER?K.postChatHistory(k,v,C,h.CHAT_TO_SELLER,oe,t.message,f):K.postChatHistory(k,v,C,h.CHAT_TO_BUYER,oe,t.message,f)),Le.value="",Fe(700)}let ge;function Fe(t){setTimeout(function(){ge!=null?ge.scrollTop=ge.scrollHeight+400:b.log("it null")},t)}function at(t){var p,y,u;return t.toString()=="0"?x("item_price__free"):ds((u=(y=(p=H==null?void 0:H.appInfo)==null?void 0:p.data)==null?void 0:y.mobileSetting)==null?void 0:u.price_format,t)}Ut(async()=>{var p,y,u,Q,$,pe,oe,ce,st;const t={userId:f,userName:"Tester"};he.child(f).set(t),await Ae.resetUnreadMessageCount(f,G),re.postUserUnreadMessageCount(te),await Z(),await R.loadItem(k,f),_.value=(p=R.item.data)==null?void 0:p.title,E.value=(u=(y=R.item.data)==null?void 0:y.category)==null?void 0:u.catName,Y.value=($=(Q=R.item.data)==null?void 0:Q.defaultPhoto)==null?void 0:$.imgPath,V.value=(pe=R.item.data)==null?void 0:pe.price,j.value=(ce=(oe=R.item.data)==null?void 0:oe.itemCurrency)==null?void 0:ce.currencySymbol,ae.value=(st=R.item.data)==null?void 0:st.isSoldOut,e.value=!0,window.addEventListener("scroll",Ie),ge=document.getElementById("messages"),de.orderByChild("itemId").equalTo(k).on("value",It=>{Ce.data=[];const Te=[];let be="",ye=se.value;It.forEach(fe=>{const U=fe.val();if(U.key=fe.key,U.offerStatus==h.CHAT_STATUS_REJECT||U.offerStatus==h.CHAT_STATUS_IS_USER_BOUGHT?ye=!0:U.offerStatus==h.CHAT_STATUS_SOLD?(ye=!1,ae.value="1"):ye=se.value,U!=null){if(U.dateTimeString=b.timeStampToDateString(U.addedDate),U.dateTimeString!=null&&U.dateTimeString!=""&&U.dateTimeString.includes(" ")){const ot=U.dateTimeString.split(" ");if(U.dateString=ot[0],U.timeString=ot[1],be==""||be!=U.dateString){be=U.dateString;const Pe={};Pe.message=U.dateString,Pe.type=h.CHAT_TYPE_DATE,Te.push(Pe)}}let Ue=new Be;Ue=Ue.fromMap(U),Te.push(Ue)}}),se.value=ye,Ce.data=Te.reverse(),Fe(1500),he.child(z).on("value",fe=>{fe.val()!=null&&fe.val().userId==z?L.value=!0:L.value=!1})})}),Pt(()=>{Re.child(f).remove(),he.child(f).remove(),window.removeEventListener("scroll",Ie)});function lt(){De.value.click()}async function nt(t){const p=t.target.files;if(p&&p.length>1)b.log(p.length);else{let y;for(let u=0;u<p.length;u++)y=p[u];if(y!=null){T.value.openModal(),T.value.setMessage(x("chat__uploading_image"));let u;f==C?u=h.CHAT_TO_BUYER:u=h.CHAT_TO_SELLER;let Q="0";L.value&&(Q="1");const $=await X.postChatImageUpload(f,C,v,k,u,Q,y);$.status==ee.SUCCESS?(o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=$.data.imgPath,o.offerStatus=h.CHAT_STATUS_NULL,o.sendByUserId=f,o.sessionId=q,o.type=h.CHAT_TYPE_IMAGE,await B(o,!0)):b.log("error"),T.value.closeModal()}}}function dt(){var t,p;((p=(t=H==null?void 0:H.appInfo)==null?void 0:t.data)==null?void 0:p.psAppSetting.SelectedChatType)==h.CHAT_AND_APPOINTMENT?O.value.openModal(_.value,E.value,Y.value,j.value,V.value):ne.value.openModal(_.value,E.value,Y.value,j.value,V.value)}async function mt(t){let p="0";L.value&&(p="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice=t,S.type=h.CHAT_TO_SELLER,S.isUserOnline=p,S.message=t,T.value.openModal();const y=await F.makeOffer(v,S);y.status==ee.ERROR?b.log(y.message):(o.id="",o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=t,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=f,o.sessionId=q,o.type=h.CHAT_TYPE_OFFER,await B(o)),await Z(),T.value.closeModal()}async function ct(t,p){let y="0";L.value&&(y="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice=t,S.type=h.CHAT_TO_SELLER,S.isUserOnline=y,S.message=t,T.value.openModal();const u=await F.makeOffer(v,S);u.status==ee.ERROR?b.log(u.message):(o.id="",o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=p+" "+t,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=f,o.sessionId=q,o.type=h.CHAT_TYPE_OFFER,await B(o)),await Z(),T.value.closeModal()}function ft(t){N.value.openModal(x("chat__confirm_title"),x("chat__confirm_to_accept_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{_t(t)},()=>{b.log("cancel")})}async function _t(t){let p="0";L.value&&(p="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice=t.message,S.type=h.CHAT_TO_BUYER,S.isUserOnline=p,S.message=t.message,T.value.openModal();const y=await F.acceptOffer(f,S);if(y.status==ee.ERROR)b.log(y.message);else{o.id=t.id,o.isSold=!1,o.isUserBought=!1,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_ACCEPT,o.addedDateTimeStamp=t.addedDate,await B(o);const u=new _e().ChatAcceptParameterHolder();u.addedDateTimeStamp=J(),u.isSold=!1,u.isUserBought=!1,u.itemId=k,u.message=t.message,u.offerStatus=h.CHAT_STATUS_ACCEPT,u.type=h.CHAT_TYPE_ACCEPT,u.sendByUserId=f,u.sessionId=q,await B(u)}await Z(),T.value.closeModal()}async function ve(t){let p="0";L.value&&(p="1"),D.itemId=k,D.buyerUserId=v,D.sellerUserId=C,D.isUserOnline=p,T.value.openModal();const y=await F.isUserBought(f,D);if(y.status==ee.ERROR)b.log(y.message);else{o.addedDateTimeStamp=t.addedDate,o.isSold=!1,o.isUserBought=!0,o.id=t.id,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_ACCEPT,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_TEXT,await B(o);const u=new _e;u.addedDateTimeStamp=J(),u.isSold=!1,u.isUserBought=!0,u.itemId=k,u.message=t.message,u.offerStatus=h.CHAT_STATUS_IS_USER_BOUGHT,u.sendByUserId=f,u.sessionId=q,u.type=h.CHAT_TYPE_BOUGHT,await B(u)}await Z(),T.value.closeModal()}function ut(t){N.value.openModal(x("item_detail__mark_as_sold_out"),x("item_detail__confirm_to_sold_out"),x("chat__confirm"),x("chat__cancel"),()=>{ht(t)},()=>{b.log("Cancel")})}async function ht(t){D.itemId=k,D.buyerUserId=v,D.sellerUserId=C,T.value.openModal();const p=await F.markAsSold(f,D);if(p.status==ee.ERROR)b.log(p.message);else{o.id=t.id,o.isSold=!0,o.isUserBought=!0,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_ACCEPT,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_TEXT,o.addedDateTimeStamp=t.addedDate,await B(o);const y=new _e;y.addedDateTimeStamp=J(),y.isSold=!0,y.isUserBought=!0,y.itemId=k,y.message=t.message,y.offerStatus=h.CHAT_STATUS_SOLD,y.sendByUserId=f,y.sessionId=q,y.type=h.CHAT_TYPE_SOLD,await B(y)}await Z(),T.value.closeModal()}function gt(t){N.value.openModal(x("chat__reject_title"),x("chat__confirm_to_reject_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{St(t)},()=>{b.log("cancel")})}function pt(t){N.value.openModal(x("chat__user_pickup_title"),x("chat__confirm_to_user_pickup_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{ve(t)},()=>{b.log("cancel")})}function yt(t){N.value.openModal(x("chat_book_appoint_done"),x("chat__confirm_to_user_appointment_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{ve(t)},()=>{b.log("cancel")})}function kt(t,p=""){N.value.openModal(x("chat__delete_message_title"),x("chat__confirm_to_delete_dialog"),x("chat__remove"),x("chat__cancel"),()=>{p!=""?Ne(t.id):Ye(t.id,p)},()=>{b.log("cancel"),me.value=""})}async function St(t){let p="0";L.value&&(p="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice="0",S.type=h.CHAT_TO_BUYER,S.isUserOnline=p,S.message=t.message,T.value.openModal();const y=await F.makeOffer(f,S);if(y.status==ee.ERROR)b.log(y.message);else{o.id=t.id,o.isSold=!1,o.isUserBought=!1,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_REJECT,o.addedDateTimeStamp=t.addedDate,await B(o);const u=new _e().ChatAcceptParameterHolder();u.addedDateTimeStamp=J(),u.isSold=!1,u.isUserBought=!1,u.itemId=k,u.message=t.message,u.offerStatus=h.CHAT_STATUS_REJECT,u.type=h.CHAT_TYPE_REJECT,u.sendByUserId=f,u.sessionId=q,await B(u)}await Z(),T.value.closeModal()}function xt(t){M.value.openModal(t)}function At(){He.value.openModal(z,()=>{s.value.openModal(x("chat__review_error"))},()=>{le.value.openModal("",x("chat__review_sent"))})}async function Ne(t){await de.child(t).remove()}async function Ye(t,p){await de.child(t).remove(),X.postChatImageDelete(p,f)}function Ct(t){me.value==""?me.value=t!=null?t:"":me.value=""}return{dataReady:e,chatHistoryProvider:K,userStore:Me,sellerUserId:C,handleScroll:Ie,chats:Ce,chatFlag:ie,sendMessage:B,inputMessageController:Le,itemName:_,itemCategory:E,itemId:k,itemImageName:Y,itemPrice:V,currency:j,PsConst:h,loginUserId:f,otherUserId:z,isOtherUserOnline:L,onImageClick:lt,image:De,onImageSelected:nt,ps_loading_dialog:T,ps_confirm_dialog:N,makeOfferClicked:dt,offer_modal:ne,booking_modal:O,review_modal:He,submitOffer:ct,submitBooking:mt,offerProvider:F,acceptOffer:ft,rejectOffer:gt,sendNormalMessage:it,isUserBought:ve,markAsSoldClick:ut,imageView:xt,chat_image:M,showOffer:se,clickGiveReview:At,ps_error_dialog:s,ps_success_dialog:le,formatPrice:at,isSoldOut:ae,chatDelete:Ne,chatImageDelete:Ye,userPickup:pt,appointmentDone:yt,deleteChatId:me,showDeleteDropDown:Ct,deleteConfirm:kt,moment:_s,appInfoStore:H,isBooking:ue}},computed:{breadcrumb(){return[{label:x("chat__chat_list"),url:route("fe_chat_list")},{label:"Chat",color:"text-fePrimary-500"}]}}},Ss={class:"relative flex flex-col",style:{height:"90vh"}},xs={class:"lg:mt-32 mt-28 h-48 flex flex-col"},As={class:"flex flex-wrap items-center mb-2 mt-2 p-2 bg-feAchromatic-50 rounded dark:bg-feAchromatic-900"},Cs={class:"flex flex-row content-end items-center cursor-pointer"},Is={alt:"Placeholder",width:"300px",height:"200px",class:"w-12 h-12 object-cover bg-feAchromatic-50 rounded-full me-2"},vs={class:"grow"},Ts={key:0,class:"flex flex-row items-center"},bs={key:1,class:"flex flex-row items-center"},Us=m("div",{class:"w-52"},null,-1),Ps={key:0},ws={key:0},Es={key:1},Os={key:0,class:"flex sm:flex-row justify-between bg-feAchromatic-50 p-2 rounded dark:bg-feAchromatic-900"},Bs={class:"flex flex-row cursor-pointer"},Hs={alt:"Placeholder",class:"w-24 h-16 object-cover bg-feAchromatic-50 rounded-md"},Ds={class:"grow grid grid-col-4 sm:flex sm:justify-between ms-4"},Rs={class:"col-span-2"},Ms={class:"col-span-2 sm:hidden flex items-center justify-end"},Ls={class:"col-span-4 flex items-center me-2"},Fs={key:0,class:"chat"},Ns={key:0},Ys={class:"flex w-full justify-center"},Gs={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block font-medium"},qs={key:1},Vs={key:0},js={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},zs={class:"px-2 py-4 mt-2 mb-1 rounded-md inline-block rounded-bl-none bg-feInfo-500"},Js=m("br",null,null,-1),Ks=m("br",null,null,-1),Xs={key:1,class:"pe-1/3 flex flex-col"},Ws={class:"flex flex-row items-end"},Zs={class:"px-2 py-4 mt-2 mb-1 rounded-md inline-block rounded-br-none bg-feInfo-500"},Qs=m("br",null,null,-1),$s=m("br",null,null,-1),eo=m("br",{class:"sm:hidden"},null,-1),to={key:1},so={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},oo={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-feError-500 text-feAchromatic-50"},ro={key:1,class:"pe-1/3 flex flex-col"},io={class:"flex flex-row items-end"},ao={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-feError-500"},lo={key:2},no={key:0},mo={key:1},co={key:0,class:"w-full flex flex-col justify-end items-end"},fo={class:"flex flex-row items-end mb-2"},_o={class:"px-2 py-4 rounded-md inline-block rounded-bl-none bg-feSuccess-500"},uo={key:0,class:"flex flex-row items-end mb-2"},ho={class:"px-2 py-4 rounded-md inline-block rounded-bl-none bg-feInfo-500"},go={key:1,class:"flex flex-row items-end mb-2"},po={class:"px-2 py-4 rounded-md inline-block rounded-bl-none bg-feError-500"},yo={key:2,class:"flex justify-center w-full mt-5"},ko={key:1,class:"pe-1/3 flex flex-col"},So={class:"flex flex-row items-end mb-2"},xo={class:"px-2 py-4 rounded-md inline-block rounded-br-none bg-feSuccess-500"},Ao={key:0,class:"flex flex-row items-end mb-2"},Co={class:"px-2 py-4 rounded-md inline-block rounded-br-none bg-feInfo-500"},Io={key:1,class:"flex flex-row items-end mb-2"},vo={class:"px-2 py-4 rounded-md inline-block rounded-br-none bg-feError-500"},To={key:3},bo={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},Uo={class:""},Po={class:"relative"},wo=["onClick"],Eo={class:"p-4 mt-2 mb-1 rounded-md inline-block rounded-bl-none bg-feSecondary-100 dark:bg-feAchromatic-800"},Oo={key:1,class:"pe-1/3 flex flex-row items-end"},Bo={class:"p-4 mt-2 mb-1 rounded-md inline-block rounded-br-none bg-fePrimary-500"},Ho={key:2},Do={class:"mt-5 mb-2 grid grid-cols-4 gap-x-4 sm:flex sm:flex-row sm:justify-center rtl:space-x-reverse sm:space-x-3"},Ro={class:"col-span-2"},Mo={key:0,class:"col-span-2"},Lo={key:3},Fo={class:"w-full mt-5 flex justify-center items-center"},No={key:4},Yo={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},Go={class:"px-2 py-4 mt-2 mb-1 rounded-md inline-block rounded-bl-none bg-feInfo-500"},qo=m("br",null,null,-1),Vo=m("br",null,null,-1),jo={key:1,class:"flex flex-col"},zo={class:"flex flex-row items-end"},Jo={class:"px-2 py-4 mt-2 mb-1 rounded-md block rounded-br-none bg-feInfo-500"},Ko=m("br",null,null,-1),Xo=m("br",null,null,-1),Wo={key:0,class:"mt-5 mb-2 grid grid-cols-4 gap-4 sm:flex sm:flex-row sm:justify-center rtl:space-x-reverse sm:space-x-4"},Zo={key:5},Qo={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end h-48 mt-4"},$o={class:"relative"},er=["onClick"],tr=["onClick"],sr={key:1,class:"pe-1/3 flex flex-row items-end h-48 mt-4"},or=["onClick"],rr={class:"mt-2 mb-0 sm:mb-0 absolute inset-y-full w-full"},ir={class:"relative flex pt-1 w-full"},ar={type:"button",class:"inline-flex items-center justify-center rounded-full h-10 w-10 transition duration-500 ease-in-out"},lr={class:"grow relative"};function nr(i,r,f,e,te,R){const re=w("Head"),v=w("ps-breadcrumb-2"),C=w("ps-route-link"),_=w("ps-label"),E=w("ps-icon"),k=w("ps-button"),Y=w("ps-label-caption-2"),V=w("ps-input"),j=w("ps-content-container"),ie=w("ps-loading-dialog"),ae=w("ps-confirm-dialog-2"),Se=w("ps-error-dialog"),H=w("ps-success-dialog"),ue=w("chat-image-detail"),xe=w("offer-modal"),K=w("booking-modal"),Ae=w("review-modal"),X=Ot("lazy");return a(),g(rt,null,[c(re,{title:i.$t("chat__title")},null,8,["title"]),c(j,{class:"h-screen"},{content:d(()=>{var F,W,S,o,D,G,T,N,le;return[m("div",Ss,[m("div",xs,[c(v,{items:R.breadcrumb},null,8,["items"]),m("div",As,[c(C,{to:{name:"fe_other_profile",query:{userId:(W=(F=e.userStore.user)==null?void 0:F.data)==null?void 0:W.userId}},class:"w-16"},{default:d(()=>{var s,M;return[m("div",Cs,[ke(m("img",Is,null,512),[[X,{src:i.$page.props.thumb1xUrl+"/"+((M=(s=e.userStore.user)==null?void 0:s.data)==null?void 0:M.userCoverPhoto),loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]])])]}),_:1},8,["to"]),m("div",vs,[c(_,{class:"font-medium text-base"},{default:d(()=>{var s,M;return[n(l((M=(s=e.userStore.user)==null?void 0:s.data)==null?void 0:M.userName),1)]}),_:1}),e.isOtherUserOnline?(a(),g("div",Ts,[c(E,{name:"dot",w:"10",h:"10",class:"text-feSuccess-300 me-2"}),c(_,null,{default:d(()=>[n(l(i.$t("chat__online")),1)]),_:1})])):(a(),g("div",bs,[c(E,{name:"dot",w:"10",h:"10",class:"text-feAchromatic-300 me-2"}),c(_,null,{default:d(()=>[n(l(i.$t("chat__offline")),1)]),_:1})]))]),Us,((o=(S=e.appInfoStore.appInfo.data)==null?void 0:S.psAppSetting)==null?void 0:o.SelectedPriceType)!=e.PsConst.PRICE_RANGE?(a(),g("div",Ps,[((G=(D=e.appInfoStore.appInfo.data)==null?void 0:D.psAppSetting)==null?void 0:G.SelectedChatType)==e.PsConst.CHAT_AND_OFFER?(a(),g("div",ws,[e.chatFlag==e.PsConst.CHAT_FROM_SELLER?(a(),A(k,{key:0,onClick:we(e.makeOfferClicked,["prevent"]),rounded:"rounded",class:"mt-2 sm:mt-0",disabled:!(e.isSoldOut!="1"&&e.showOffer)},{default:d(()=>[n(l(i.$t("chat__make_an_offer")),1)]),_:1},8,["onClick","disabled"])):P("",!0)])):P("",!0)])):P("",!0),((N=(T=e.appInfoStore.appInfo.data)==null?void 0:T.psAppSetting)==null?void 0:N.SelectedChatType)==e.PsConst.CHAT_AND_APPOINTMENT?(a(),g("div",Es,[e.chatFlag==e.PsConst.CHAT_FROM_SELLER?(a(),A(k,{key:0,onClick:we(e.makeOfferClicked,["prevent"]),rounded:"rounded",class:"mt-2 sm:mt-0",disabled:!(e.isSoldOut!="1"&&e.showOffer)},{default:d(()=>[n(l(i.$t("chat_book")),1)]),_:1},8,["onClick","disabled"])):P("",!0)])):P("",!0)]),e.dataReady?(a(),g("div",Os,[c(C,{to:{name:"fe_item_detail",query:{item_id:e.itemId}}},{default:d(()=>[m("div",Bs,[ke(m("img",Hs,null,512),[[X,{src:i.$page.props.thumb2xUrl+"/"+e.itemImageName,loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]])])]),_:1},8,["to"]),m("div",Ds,[m("div",Rs,[c(_,{textColor:"font-semibold text-fePrimary-500",class:"text-xs sm:text-xl"},{default:d(()=>[n(l(e.itemName),1)]),_:1}),c(_,{class:"font-normal text-lg"},{default:d(()=>[n(l(e.itemCategory),1)]),_:1}),c(_,{class:"font-normal text-xs",textColor:"text-feAchromatic-500"},{default:d(()=>[n(l(e.currency)+" "+l(e.formatPrice(e.itemPrice)),1)]),_:1})]),m("div",Ms,[c(C,{to:{name:"fe_item_detail",query:{item_id:e.itemId}},class:"block sm:hidden"},{default:d(()=>[c(E,{name:"doubleRightArrow"})]),_:1},8,["to"])]),m("div",Ls,[(le=e.appInfoStore)!=null&&le.isSoldOutFeatureSettingOn()?(a(),A(k,{key:0,class:Ee([e.isSoldOut=="1"?"":"hidden","h-[20px] sm:h-[28px]"]),rounded:"rounded",hover:!1},{default:d(()=>[n(l(i.$t("chat__mark_sold_out")),1)]),_:1},8,["class"])):P("",!0),c(C,{to:{name:"fe_item_detail",query:{item_id:e.itemId}},class:"hidden sm:block"},{default:d(()=>[c(E,{name:"doubleRightArrow"})]),_:1},8,["to"])])])])):P("",!0)]),m("div",{ref:"messages",onScroll:r[2]||(r[2]=(...s)=>e.handleScroll&&e.handleScroll(...s)),id:"messages",class:"px-4 flex flex-col-reverse overflow-y-auto mt-14 sm:mt-3 h-full scrolling-touch"},[(a(!0),g(rt,null,wt(e.chats.data,s=>{var M,ne;return a(),g("div",{key:(M=s.id)!=null?M:""},[s.message!=""&&s.message!=null?(a(),g("div",Fs,[s.type==e.PsConst.CHAT_TYPE_DATE?(a(),g("div",Ns,[m("div",Ys,[m("span",Gs,[c(_,null,{default:d(()=>[n(l(s.message),1)]),_:2},1024)])])])):s.type==e.PsConst.CHAT_TYPE_TEXT?(a(),g("div",qs,[s.offerStatus==e.PsConst.CHAT_STATUS_OFFER?(a(),g("div",Vs,[s.sendByUserId==e.loginUserId?(a(),g("div",js,[c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),m("span",zs,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat_book_make_booking"))+" ",1),Js,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat__send_offer"))+" ",1),Ks,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))])])):(a(),g("div",Xs,[m("div",Ws,[m("span",Zs,[e.isBooking?(a(),A(_,{key:0,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_received_booking"))+" ",1),Qs,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__receive_offer"))+" ",1),$s,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))]),eo,c(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])]))])):s.offerStatus==e.PsConst.CHAT_STATUS_REJECT?(a(),g("div",to,[s.sendByUserId==e.loginUserId?(a(),g("div",so,[c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),m("span",oo,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_reject")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_rejected_item")),1)]),_:1}))])])):(a(),g("div",ro,[m("div",io,[m("span",ao,[e.isBooking?(a(),A(_,{key:0,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_reject")),1)]),_:1})):(a(),A(_,{key:1,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_rejected_item")),1)]),_:1}))]),c(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])]))])):s.offerStatus==e.PsConst.CHAT_STATUS_ACCEPT?(a(),g("div",lo,[s.isSold&&s.isUserBought?(a(),g("div",no)):(a(),g("div",mo,[s.sendByUserId==e.loginUserId?(a(),g("div",co,[m("div",fo,[c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),m("span",_o,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_accept")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_accepted_item")),1)]),_:1}))])]),s.isUserBought?(a(),g("div",uo,[c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),m("span",ho,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_appoint_done")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_pickup")),1)]),_:1}))])])):P("",!0),e.isSoldOut=="1"?(a(),g("div",go,[c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),m("span",po,[c(_,{class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_soldout")),1)]),_:1})])])):P("",!0),s.offerStatus==e.PsConst.CHAT_STATUS_ACCEPT&&s.isUserBought==!1?(a(),g("div",yo,[e.isBooking?(a(),A(k,{key:0,onClick:O=>e.appointmentDone(s),colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",focus:"focus:text-feAchromatic-50 focus:bg-fePrimary-500",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat_book_appoint_done")),1)]),_:2},1032,["onClick"])):(a(),A(k,{key:1,onClick:O=>e.userPickup(s),colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",focus:"focus:text-feAchromatic-50 focus:bg-fePrimary-500",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__user_has_a_pickup")),1)]),_:2},1032,["onClick"]))])):P("",!0)])):(a(),g("div",ko,[m("div",So,[m("span",xo,[e.isBooking?(a(),A(_,{key:0,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_accept")),1)]),_:1})):(a(),A(_,{key:1,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_accepted_item")),1)]),_:1}))]),c(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),s.isUserBought?(a(),g("div",Ao,[m("span",Co,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_appoint_done")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_pickup")),1)]),_:1}))]),c(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])):P("",!0),e.isSoldOut=="1"?(a(),g("div",Io,[m("span",vo,[c(_,{class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_soldout")),1)]),_:1})]),c(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])):P("",!0)]))]))])):(a(),g("div",To,[s.sendByUserId==e.loginUserId?(a(),g("div",bo,[m("div",Uo,[c(Y,{onClick:O=>e.showDeleteDropDown(s.id),class:Ee([e.deleteChatId==s.id?"":"del","cursor-pointer rounded float-right"]),textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[c(E,{name:"verticalThreeDot",class:"text-feAchromatic-50Dark"})]),_:2},1032,["onClick","class"]),m("div",Po,[e.deleteChatId==s.id?(a(),g("div",{key:0,onClick:O=>e.deleteConfirm(s),class:"bg-feAchromatic-50 shadow-sm relative top-4 right-2 px-1 rounded border transform cursor-pointer text-sm dark:bg-feAchromatic-900 dark:text-feAchromatic-50"},l(i.$t("chat__delete_messages")),9,wo)):P("",!0)]),c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),m("span",Eo,[c(_,{class:"text-sm"},{default:d(()=>[n(l(s.message),1)]),_:2},1024)])])):(a(),g("div",Oo,[m("span",Bo,[c(_,{textColor:"text-feAchromatic-50",class:"text-sm"},{default:d(()=>[n(l(s.message),1)]),_:2},1024)]),c(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]))]))])):s.type==e.PsConst.CHAT_TYPE_BOUGHT?(a(),g("div",Ho,[m("div",Do,[m("div",Ro,[c(k,{onClick:r[0]||(r[0]=O=>e.clickGiveReview()),colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__leave_a_review")),1)]),_:1})]),s.sendByUserId==e.loginUserId&&s.offerStatus==e.PsConst.CHAT_STATUS_IS_USER_BOUGHT&&((ne=e.appInfoStore)==null?void 0:ne.isSoldOutFeatureSettingOn())?(a(),g("div",Mo,[c(k,{onClick:O=>e.markAsSoldClick(s),class:"w-full",colors:"bg-fePrimary-500 text-feAchromatic-50 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__mark_sold_out")),1)]),_:2},1032,["onClick"])])):P("",!0)])])):s.type==e.PsConst.CHAT_TYPE_SOLD?(a(),g("div",Lo,[m("div",Fo,[m("div",null,[c(k,{onClick:r[1]||(r[1]=O=>e.clickGiveReview()),class:"h-9",colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__leave_a_review")),1)]),_:1})])])])):s.type==e.PsConst.CHAT_TYPE_OFFER?(a(),g("div",No,[s.sendByUserId==e.loginUserId?(a(),g("div",Yo,[c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),m("span",Go,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat_book_make_booking"))+" ",1),qo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat__send_offer"))+" ",1),Vo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))])])):(a(),g("div",jo,[m("div",zo,[m("span",Jo,[e.isBooking?(a(),A(_,{key:0,class:"dark:text-feAchromatic-800",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_received_booking"))+" ",1),Ko,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,class:"dark:text-feAchromatic-800",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__receive_offer"))+" ",1),Xo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))]),c(_,{class:"ms-2 mb-2 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),s.offerStatus==e.PsConst.CHAT_STATUS_OFFER?(a(),g("div",Wo,[c(k,{onClick:O=>e.acceptOffer(s),class:"col-span-2 sm:w-[140px] h-9",textSize:"font-normal text-xxs lg:text-sm",colors:"bg-feSuccess-600 cursor-pointer text-feAchromatic-50",rounded:"rounded",hover:"hover:bg-feSuccess-700",focus:"focus:bg-feSuccess-700"},{default:d(()=>[n(l(i.$t("chat__accept")),1)]),_:2},1032,["onClick"]),c(k,{onClick:O=>e.rejectOffer(s),class:"col-span-2 sm:w-[140px] h-9",textSize:"font-normal text-xxs lg:text-sm",colors:"text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",focus:"focus:text-feAchromatic-50 focus:bg-fePrimary-500",border:"border border-feAchromatic-300 dark:border-feAchromatic-500",rounded:"rounded"},{default:d(()=>[n(l(i.$t("chat__reject")),1)]),_:2},1032,["onClick"])])):P("",!0)]))])):s.type==e.PsConst.CHAT_TYPE_IMAGE?(a(),g("div",Zo,[s.sendByUserId==e.loginUserId?(a(),g("div",Qo,[m("div",$o,[c(Y,{onClick:O=>e.showDeleteDropDown(s.id),class:Ee([e.deleteChatId==s.id?"":"del","cursor-pointer rounded float-right"]),textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[c(E,{name:"verticalThreeDot",class:"text-feAchromatic-50Dark"})]),_:2},1032,["onClick","class"]),e.deleteChatId==s.id?(a(),g("div",{key:0,onClick:O=>e.deleteConfirm(s,s.message),class:"bg-feAchromatic-50 shadow-sm absolute top-4 right-2 p-1 rounded border cursor-pointer transform"},l(i.$t("chat__delete_messages")),9,er)):P("",!0),c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),ke(m("img",{onClick:O=>e.imageView(s.message),width:"300px",height:"200px",alt:"Placeholder",class:"cursor-pointer w-auto h-48 p-2 object-cover rounded-md"},null,8,tr),[[X,{src:i.$page.props.thumb3xUrl+"/"+s.message,loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]])])):(a(),g("div",sr,[ke(m("img",{onClick:O=>e.imageView(s.message),width:"300px",height:"200px",alt:"Placeholder",class:"cursor-pointer w-auto h-48 p-2 object-cover rounded-md"},null,8,or),[[X,{src:i.$page.props.thumb3xUrl+"/"+s.message,loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]]),c(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]))])):P("",!0)])):P("",!0)])}),128))],544),m("div",rr,[m("div",ir,[m("div",{for:"upload-image1",onClick:r[4]||(r[4]=(...s)=>e.onImageClick&&e.onImageClick(...s))},[m("input",{class:"py-2",type:"file",size:"1",max:"1",accept:".jpg,.jpeg,.png",onChange:r[3]||(r[3]=s=>e.onImageSelected(s)),ref:"image",id:"upload-image1",style:{display:"none"},ordering:1},null,544),m("button",ar,[c(E,{name:"camera",textColor:"text-fePrimary-500 dark:text-fePrimary-500"})])]),m("div",lr,[c(V,{placeholder:i.$t("chat__type_message"),onKeyup:r[5]||(r[5]=Et(s=>e.sendNormalMessage(e.inputMessageController),["enter"])),value:e.inputMessageController,"onUpdate:value":r[6]||(r[6]=s=>e.inputMessageController=s),class:"mt-1",theme:"form-input dark:bg-feAchromatic-800 text-feSecondary-500 dark:text-feAchromatic-50"},null,8,["placeholder","value"]),m("button",{type:"button",onClick:r[7]||(r[7]=we(s=>e.sendNormalMessage(e.inputMessageController),["prevent"])),class:"absolute right-3 top-3"},[c(E,{name:"send",textColor:"text-fePrimary-500 dark:text-fePrimary-500"})])])])])])]}),_:1}),c(ie,{ref:"ps_loading_dialog"},null,512),c(ae,{ref:"ps_confirm_dialog"},null,512),c(Se,{ref:"ps_error_dialog"},null,512),c(H,{ref:"ps_success_dialog"},null,512),c(ue,{ref:"chat_image"},null,512),c(xe,{ref:"offer_modal",price:e.itemPrice,onSubmit:e.submitOffer},null,8,["price","onSubmit"]),c(K,{ref:"booking_modal",price:e.itemPrice,onSubmit:e.submitBooking},null,8,["price","onSubmit"]),c(Ae,{ref:"review_modal"},null,512)],64)}var Ji=us(ks,[["render",nr]]);export{Ji as default};
